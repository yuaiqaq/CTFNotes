# 共模攻击下 e1=p,e2=q

### buuctf [NPUCTF2020]共 模 攻 击

~~~
from gmpy2 import *
from Crypto.Util.number import *
#hint:m.bit_length() < 400

flag = flag.strip(b"npuctf{").strip(b"}")
m = bytes_to_long(flag)

p, q = getPrime(512), getPrime(512)
n = p * q
e1, e2 = p, q
c1, c2 = pow(m, e1, n), pow(m, e2, n)

print(n)
print(c1)
print(c2)

'''
128205304743751985889679351195836799434324346996129753896234917982647254577214018524580290192396070591032007818847697193260130051396080104704981594190602854241936777324431673564677900773992273463534717009587530152480725448774018550562603894883079711995434332008363470321069097619786793617099517770260029108149
96860654235275202217368130195089839608037558388884522737500611121271571335123981588807994043800468529002147570655597610639680977780779494880330669466389788497046710319213376228391138021976388925171307760030058456934898771589435836261317283743951614505136840364638706914424433566782044926111639955612412134198
9566853166416448316408476072940703716510748416699965603380497338943730666656667456274146023583837768495637484138572090891246105018219222267465595710692705776272469703739932909158740030049375350999465338363044226512016686534246611049299981674236577960786526527933966681954486377462298197949323271904405241585
'''
~~~

$ c1=m^p mod n = m^P mod p*q $

$c1=m^q mod n = m^q mod p*q$

因为p，q位素数，所以由费马定理可得：

$m^p = m$ mod p

m^q^ = m mod q

所以，又有

c1=m+ip+xpq, 可整理成c1=m+ip

c2=m+ip+xpq, 可整理成c2=m+jq

因此 

$ c1*c2=m^2+(ip+jq)m+ijn$

$ (c1+c2)m=2m^2+(ip+jq)m$

有：$m^2-(c1+c2)m+c1*c2=ijn=0 mod n$

~~~python
a=c1+c2
b=c1*c2
R.<x>=Zmod(n)[]
f = x^2 - a*x +b
X=f.small_roots(X=2^400)
print(libnum.n2s(X))
~~~

